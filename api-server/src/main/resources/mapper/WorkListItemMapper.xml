<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.task.mapper.WorkListItemMapper">

    <resultMap id="WorkListItemResultMap" type="com.example.task.entity.WorkListItem">
        <id column="id" property="id"/>
        <result column="work_list_id" property="workListId"/>
        <result column="name" property="name"/>
        <result column="description" property="description"/>
        <result column="priority" property="priority"/>
        <result column="estimated_time" property="estimatedTime"/>
        <result column="execution_status" property="executionStatus"/>
        <result column="feedback" property="feedback"/>
        <result column="completed_at" property="completedAt"/>
        <result column="sort_order" property="sortOrder"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <insert id="insertBatch">
        INSERT INTO work_list_item (work_list_id, name, description, priority, estimated_time, execution_status, sort_order)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.workListId}, #{item.name}, #{item.description}, #{item.priority},
             #{item.estimatedTime}, #{item.executionStatus}, #{item.sortOrder})
        </foreach>
    </insert>

    <update id="update" parameterType="com.example.task.entity.WorkListItem">
        UPDATE work_list_item
        SET name             = #{name},
            description      = #{description},
            priority         = #{priority},
            estimated_time   = #{estimatedTime},
            execution_status = #{executionStatus},
            feedback         = #{feedback},
            completed_at     = #{completedAt},
            sort_order       = #{sortOrder},
            updated_at       = NOW()
        WHERE id = #{id}
    </update>

    <select id="selectByWorkListId" parameterType="long" resultMap="WorkListItemResultMap">
        SELECT *
        FROM work_list_item
        WHERE work_list_id = #{workListId}
        ORDER BY sort_order ASC, id ASC
    </select>

</mapper>


